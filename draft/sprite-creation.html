<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pixelar - Create Sprite</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;700&display=swap"
        rel="stylesheet">

    <script src="https://unpkg.com/lucide@latest"></script>

    <script src="https://cdn.tailwindcss.com"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            accent: '#FF715B',
                            accentHover: '#FF4F33',
                            surface: '#FFFFFF',
                            canvas: '#F4F4F0',
                            border: '#18181B',
                            text: '#18181B',
                            textMuted: '#71717A'
                        }
                    },
                    fontFamily: {
                        sans: ['Space Grotesk', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    boxShadow: {
                        'hard': '4px 4px 0px 0px #18181B',
                        'hard-sm': '2px 2px 0px 0px #18181B',
                        'hard-hover': '6px 6px 0px 0px #18181B',
                        'hard-active': '0px 0px 0px 0px #18181B',
                    },
                    borderWidth: {
                        '3': '3px',
                    },
                    backgroundImage: {
                        'sprite-grid': `linear-gradient(45deg, #f1f1f1 25%, transparent 25%),
                                        linear-gradient(-45deg, #f1f1f1 25%, transparent 25%),
                                        linear-gradient(45deg, transparent 75%, #f1f1f1 75%),
                                        linear-gradient(-45deg, transparent 75%, #f1f1f1 75%)`
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #F4F4F0;
            background-image: radial-gradient(#D4D4D8 2px, transparent 2px);
            background-size: 24px 24px;
        }

        .btn-press {
            transition: all 0.1s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .btn-press:active {
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0px 0px #18181B;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #F4F4F0;
            border-left: 2px solid #18181B;
        }

        ::-webkit-scrollbar-thumb {
            background: #18181B;
            border: 2px solid #F4F4F0;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #FF715B;
        }

        /* Brutalist Range Slider */
        input[type=range] {
            -webkit-appearance: none;
            background: transparent;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            background: #FF715B;
            border: 2px solid #18181B;
            cursor: pointer;
            margin-top: -6px;
            box-shadow: 2px 2px 0px 0px #18181B;
            border-radius: 50%;
        }

        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #18181B;
            border: 0;
            border-radius: 2px;
        }

        /* Toggle Switch */
        .toggle-checkbox:checked {
            right: 0;
            border-color: #18181B;
        }

        .toggle-checkbox:checked+.toggle-label {
            background-color: #FF715B;
        }

        /* Loading Scanline */
        @keyframes scan {
            0% {
                transform: translateY(-100%);
            }

            100% {
                transform: translateY(100%);
            }
        }

        .scanline {
            animation: scan 2s linear infinite;
            background: linear-gradient(to bottom, transparent, rgba(255, 113, 91, 0.2), transparent);
        }

        /* Pixelated Image Rendering */
        .image-pixelated {
            image-rendering: pixelated;
        }

        /* Custom Radio Button Styling */
        input[type="radio"]:checked+div {
            background-color: #18181B;
            color: #FFFFFF;
        }

        input[type="radio"]:checked+div .check-icon {
            opacity: 1;
        }

        /* Custom number input styling */
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
    </style>
</head>

<body
    class="text-brand-text font-sans antialiased min-h-screen flex flex-col relative selection:bg-brand-accent selection:text-white">

    <header class="bg-white border-b-3 border-brand-border sticky top-0 z-50">
        <div class="max-w-[1600px] mx-auto px-6 h-20 flex items-center justify-between">
            <div class="flex items-center gap-6">
                <a href="projects.html"
                    class="flex items-center gap-2 font-mono text-xs font-bold hover:text-brand-accent transition-colors group">
                    <i data-lucide="arrow-left" class="w-4 h-4 group-hover:-translate-x-1 transition-transform"></i>
                    DASHBOARD
                </a>
                <div class="h-6 w-0.5 bg-brand-border/20"></div>
                <h1 class="text-xl font-bold tracking-tight text-brand-text font-sans uppercase">Sprite Generator<span
                        class="text-brand-accent">.exe</span></h1>
            </div>

            <div class="flex items-center gap-4">
                <div
                    class="hidden md:flex items-center gap-2 font-mono text-xs font-bold text-brand-textMuted px-3 py-1 bg-brand-canvas border border-brand-border">
                    STATUS: READY
                </div>
                <div
                    class="flex items-center gap-2 font-mono text-xs font-bold text-brand-text bg-white px-3 py-1 border-2 border-brand-border shadow-hard-sm">
                    <i data-lucide="zap" class="w-3 h-3 text-brand-accent"></i>
                    CREDITS: <span id="creditCount">449</span>
                </div>
            </div>
        </div>
    </header>

    <main class="flex-1 max-w-[1600px] mx-auto w-full p-6 md:p-10 grid lg:grid-cols-12 gap-8">

        <section class="lg:col-span-4 xl:col-span-3 space-y-8 h-full flex flex-col">

            <div class="space-y-3">
                <label class="font-mono text-xs font-bold uppercase text-brand-text flex items-center gap-2">
                    <i data-lucide="terminal" class="w-4 h-4"></i>
                    /// PROMPT_TERMINAL
                </label>
                <div class="relative group">
                    <textarea id="promptInput" rows="4"
                        class="w-full bg-white border-3 border-brand-border p-4 font-mono text-sm outline-none focus:border-brand-accent focus:shadow-hard transition-all resize-none placeholder:text-gray-300 z-10 relative"
                        placeholder="Describe your sprite... (e.g., A cybernetic samurai with glowing red eyes, idle stance, pixel art style)"></textarea>
                    <div class="absolute inset-0 bg-brand-border translate-x-1 translate-y-1 -z-0"></div>
                </div>
            </div>

            <!-- Dimensions -->
            <div class="space-y-3">
                <label class="font-mono text-xs font-bold uppercase text-brand-textMuted">/// DIMENSIONS</label>
                <div class="grid grid-cols-4 gap-2">
                    <!-- Option 1 -->
                    <label class="cursor-pointer group relative">
                        <input type="radio" name="dimensions" value="16" class="peer sr-only"
                            onchange="toggleCustomDims()">
                        <div
                            class="border-2 border-brand-border bg-white p-2 flex flex-col items-center justify-center gap-1 hover:bg-brand-canvas transition-colors h-16">
                            <div class="w-3 h-3 border-2 border-current rounded-sm"></div>
                            <span class="font-mono text-[10px] font-bold">16×16</span>
                            <i data-lucide="check"
                                class="check-icon w-3 h-3 absolute top-1 right-1 opacity-0 transition-opacity text-brand-accent"></i>
                        </div>
                    </label>
                    <!-- Option 2 -->
                    <label class="cursor-pointer group relative">
                        <input type="radio" name="dimensions" value="32" class="peer sr-only"
                            onchange="toggleCustomDims()" checked>
                        <div
                            class="border-2 border-brand-border bg-white p-2 flex flex-col items-center justify-center gap-1 hover:bg-brand-canvas transition-colors h-16">
                            <div class="w-4 h-4 border-2 border-current rounded-sm"></div>
                            <span class="font-mono text-[10px] font-bold">32×32</span>
                            <i data-lucide="check"
                                class="check-icon w-3 h-3 absolute top-1 right-1 opacity-0 transition-opacity text-brand-accent"></i>
                        </div>
                    </label>
                    <!-- Option 3 -->
                    <label class="cursor-pointer group relative">
                        <input type="radio" name="dimensions" value="64" class="peer sr-only"
                            onchange="toggleCustomDims()">
                        <div
                            class="border-2 border-brand-border bg-white p-2 flex flex-col items-center justify-center gap-1 hover:bg-brand-canvas transition-colors h-16">
                            <div class="w-5 h-5 border-2 border-current rounded-sm"></div>
                            <span class="font-mono text-[10px] font-bold">64×64</span>
                            <i data-lucide="check"
                                class="check-icon w-3 h-3 absolute top-1 right-1 opacity-0 transition-opacity text-brand-accent"></i>
                        </div>
                    </label>
                    <!-- Option 4: Custom -->
                    <label class="cursor-pointer group relative">
                        <input type="radio" name="dimensions" value="custom" class="peer sr-only"
                            onchange="toggleCustomDims()">
                        <div
                            class="border-2 border-brand-border bg-white p-2 flex flex-col items-center justify-center gap-1 hover:bg-brand-canvas transition-colors h-16">
                            <i data-lucide="sliders-horizontal" class="w-4 h-4"></i>
                            <span class="font-mono text-[10px] font-bold">CUSTOM</span>
                            <i data-lucide="check"
                                class="check-icon w-3 h-3 absolute top-1 right-1 opacity-0 transition-opacity text-brand-accent"></i>
                        </div>
                    </label>
                </div>

                <!-- Custom Inputs (Hidden by default) -->
                <div id="customDimsContainer" class="hidden grid-cols-2 gap-4 pt-2">
                    <div class="relative">
                        <span
                            class="absolute left-3 top-2.5 font-mono text-xs text-brand-textMuted font-bold">W:</span>
                        <input type="number" value="128" id="customWidth"
                            class="w-full bg-white border-2 border-brand-border py-2 pl-8 pr-2 font-mono text-sm outline-none focus:shadow-hard-sm">
                    </div>
                    <div class="relative">
                        <span
                            class="absolute left-3 top-2.5 font-mono text-xs text-brand-textMuted font-bold">H:</span>
                        <input type="number" value="128" id="customHeight"
                            class="w-full bg-white border-2 border-brand-border py-2 pl-8 pr-2 font-mono text-sm outline-none focus:shadow-hard-sm">
                    </div>
                </div>
            </div>

            <!-- Palette -->
            <div class="space-y-3">
                <label class="font-mono text-xs font-bold uppercase text-brand-textMuted">/// COLOR_PALETTE</label>
                <div class="grid grid-cols-2 gap-2">
                    <label class="cursor-pointer group relative">
                        <input type="radio" name="palette" value="full" class="peer sr-only" checked>
                        <div
                            class="border-2 border-brand-border bg-white px-2 py-3 flex flex-col items-center justify-center hover:bg-brand-canvas transition-colors h-20 text-center">
                            <i data-lucide="palette" class="w-4 h-4 mb-2"></i>
                            <span class="font-mono text-[10px] font-bold">FULL COLOR</span>
                            <i data-lucide="check"
                                class="check-icon w-3 h-3 absolute top-1 right-1 opacity-0 transition-opacity text-brand-accent"></i>
                        </div>
                    </label>

                    <label class="cursor-pointer group relative">
                        <input type="radio" name="palette" value="gameboy" class="peer sr-only">
                        <div
                            class="border-2 border-brand-border bg-white px-2 py-3 flex flex-col items-center justify-center hover:bg-brand-canvas transition-colors h-20 text-center">
                            <i data-lucide="monitor" class="w-4 h-4 mb-2"></i>
                            <span class="font-mono text-[10px] font-bold">GAMEBOY</span>
                            <i data-lucide="check"
                                class="check-icon w-3 h-3 absolute top-1 right-1 opacity-0 transition-opacity text-brand-accent"></i>
                        </div>
                    </label>

                    <label class="cursor-pointer group relative">
                        <input type="radio" name="palette" value="pico8" class="peer sr-only">
                        <div
                            class="border-2 border-brand-border bg-white px-2 py-3 flex flex-col items-center justify-center hover:bg-brand-canvas transition-colors h-20 text-center">
                            <i data-lucide="grid" class="w-4 h-4 mb-2"></i>
                            <span class="font-mono text-[10px] font-bold">PICO-8</span>
                            <i data-lucide="check"
                                class="check-icon w-3 h-3 absolute top-1 right-1 opacity-0 transition-opacity text-brand-accent"></i>
                        </div>
                    </label>

                    <label class="cursor-pointer group relative">
                        <input type="radio" name="palette" value="nes" class="peer sr-only">
                        <div
                            class="border-2 border-brand-border bg-white px-2 py-3 flex flex-col items-center justify-center hover:bg-brand-canvas transition-colors h-20 text-center">
                            <i data-lucide="gamepad-2" class="w-4 h-4 mb-2"></i>
                            <span class="font-mono text-[10px] font-bold">NES</span>
                            <i data-lucide="check"
                                class="check-icon w-3 h-3 absolute top-1 right-1 opacity-0 transition-opacity text-brand-accent"></i>
                        </div>
                    </label>
                </div>
            </div>

            <!-- Color Swatch -->
            <div class="space-y-3">
                <div class="flex justify-between items-center">
                    <label class="font-mono text-xs font-bold uppercase text-brand-textMuted">///
                        COLOR_REFERENCE</label>
                    <span
                        class="text-[10px] font-mono text-brand-textMuted bg-gray-100 px-1 border border-gray-200">OPTIONAL</span>
                </div>
                <div class="grid grid-cols-5 gap-2">
                    <div class="col-span-4 grid grid-cols-4 gap-2" id="colorSwatchContainer">
                        <div class="relative h-12 border-2 border-brand-border bg-white hover:bg-brand-canvas transition-colors cursor-pointer group flex items-center justify-center">
                            <input type="color" id="color1" value="#FF715B"
                                class="absolute inset-0 opacity-0 cursor-pointer">
                            <div class="w-full h-full" style="background-color: #FF715B;"></div>
                        </div>
                        <div class="relative h-12 border-2 border-brand-border bg-white hover:bg-brand-canvas transition-colors cursor-pointer group flex items-center justify-center">
                            <input type="color" id="color2" value="#18181B"
                                class="absolute inset-0 opacity-0 cursor-pointer">
                            <div class="w-full h-full" style="background-color: #18181B;"></div>
                        </div>
                        <div class="relative h-12 border-2 border-brand-border bg-white hover:bg-brand-canvas transition-colors cursor-pointer group flex items-center justify-center">
                            <input type="color" id="color3" value="#F4F4F0"
                                class="absolute inset-0 opacity-0 cursor-pointer">
                            <div class="w-full h-full" style="background-color: #F4F4F0;"></div>
                        </div>
                        <div class="relative h-12 border-2 border-brand-border bg-white hover:bg-brand-canvas transition-colors cursor-pointer group flex items-center justify-center">
                            <input type="color" id="color4" value="#71717A"
                                class="absolute inset-0 opacity-0 cursor-pointer">
                            <div class="w-full h-full" style="background-color: #71717A;"></div>
                        </div>
                    </div>
                    <button onclick="clearColors()"
                        class="h-12 border-2 border-brand-border bg-white hover:bg-brand-canvas transition-colors flex items-center justify-center">
                        <i data-lucide="x" class="w-4 h-4 text-brand-textMuted"></i>
                    </button>
                </div>
                <p class="font-mono text-[10px] text-brand-textMuted">Click swatches to define color palette</p>
            </div>

            <div class="space-y-3">
                <div class="flex justify-between items-center">
                    <label class="font-mono text-xs font-bold uppercase text-brand-textMuted">///
                        REFERENCE_SIGNAL</label>
                    <span
                        class="text-[10px] font-mono text-brand-textMuted bg-gray-100 px-1 border border-gray-200">OPTIONAL</span>
                </div>
                <div
                    class="border-2 border-dashed border-brand-textMuted/50 bg-brand-canvas/50 rounded-none p-4 flex flex-col items-center justify-center text-center cursor-pointer hover:bg-brand-canvas hover:border-brand-text transition-all group">
                    <div
                        class="w-10 h-10 bg-white border-2 border-brand-border flex items-center justify-center mb-2 shadow-hard-sm group-hover:-translate-y-1 transition-transform">
                        <i data-lucide="upload-cloud" class="w-5 h-5 text-brand-text"></i>
                    </div>
                    <p class="font-mono text-[10px] font-bold text-brand-textMuted">DRAG_DROP OR CLICK TO UPLOAD</p>
                    <p class="font-mono text-[10px] text-brand-textMuted">Style reference / transfer</p>
                    <input type="file" class="absolute inset-0 opacity-0 cursor-pointer">
                </div>
            </div>

            <div class="pt-4 border-t-2 border-brand-border">
                <button onclick="generateSprite()" id="generateBtn"
                    class="btn-press w-full bg-brand-accent text-white border-3 border-brand-border shadow-hard hover:bg-brand-accentHover py-4 flex items-center justify-center gap-3 group relative overflow-hidden transition-all">
                    <span class="font-mono font-bold text-sm tracking-widest uppercase z-10">Initialize Generation</span>
                    <span class="font-mono text-[10px] font-bold bg-black/20 px-2 py-0.5 rounded text-white z-10">-1
                        CREDIT</span>
                    <i data-lucide="cpu" class="w-5 h-5 z-10 group-hover:rotate-90 transition-transform"></i>
                </button>
            </div>

        </section>

        <section class="lg:col-span-8 xl:col-span-9 flex flex-col gap-6">

            <div class="bg-white border-3 border-brand-border shadow-hard flex flex-col relative overflow-hidden transition-all duration-300"
                id="rigContainer">

                <div
                    class="bg-brand-canvas border-b-2 border-brand-border p-3 flex items-center justify-between z-10 relative">
                    <div class="flex items-center gap-2">
                        <i data-lucide="box" class="w-4 h-4 text-brand-accent"></i>
                        <span class="font-mono text-xs font-bold uppercase">ARMATURE_RIG_V3.0</span>
                    </div>

                    <div class="flex items-center gap-3">
                        <span class="font-mono text-[10px] font-bold text-brand-textMuted uppercase">Rigging Mode</span>
                        <div
                            class="relative inline-block w-10 h-5 align-middle select-none transition duration-200 ease-in">
                            <input type="checkbox" name="toggle" id="rigToggle"
                                class="toggle-checkbox absolute block w-5 h-5 rounded-full bg-white border-2 border-brand-border appearance-none cursor-pointer transition-all duration-200 left-0 -top-0.5 z-10 shadow-sm"
                                onclick="toggleRigPanel()" />
                            <label for="rigToggle"
                                class="toggle-label block overflow-hidden h-4 rounded-full bg-gray-300 cursor-pointer border-2 border-transparent"></label>
                        </div>
                    </div>
                </div>

                <div id="rigPanel" class="hidden h-[500px] flex flex-col md:flex-row relative">

                    <div class="flex-1 bg-gray-200 relative cursor-move group" id="canvasContainer">
                        <div
                            class="absolute top-4 left-4 pointer-events-none z-10 bg-white/80 backdrop-blur border border-brand-border px-2 py-1">
                            <p class="font-mono text-[10px] font-bold">LMB: ROTATE | RMB: PAN</p>
                        </div>
                    </div>

                    <div
                        class="w-full md:w-80 bg-white border-t-2 md:border-t-0 md:border-l-2 border-brand-border p-5 flex flex-col gap-4 overflow-y-auto">
                        <div
                            class="text-xs font-mono font-bold text-brand-text uppercase mb-2 pb-2 border-b-2 border-brand-border">
                            /// SIZE CONTROLS</div>

                        <div class="space-y-1">
                            <div
                                class="flex justify-between font-mono text-[10px] font-bold text-brand-textMuted uppercase">
                                <span>Overall Height</span>
                                <span id="valHeight">1.0x</span>
                            </div>
                            <input type="range" min="0.5" max="1.5" step="0.05" value="1.0" class="w-full"
                                oninput="update3DModel('height', this.value)">
                        </div>

                        <div class="space-y-1">
                            <div
                                class="flex justify-between font-mono text-[10px] font-bold text-brand-textMuted uppercase">
                                <span>Head Size</span>
                                <span id="valHead">1.0x</span>
                            </div>
                            <input type="range" min="0.5" max="2.5" step="0.1" value="1.0" class="w-full"
                                oninput="update3DModel('head', this.value)">
                        </div>

                        <div class="space-y-1">
                            <div
                                class="flex justify-between font-mono text-[10px] font-bold text-brand-textMuted uppercase">
                                <span>Torso Length</span>
                                <span id="valTorsoLength">1.0x</span>
                            </div>
                            <input type="range" min="0.7" max="1.5" step="0.05" value="1.0" class="w-full"
                                oninput="update3DModel('torsoLength', this.value)">
                        </div>

                        <div class="space-y-1">
                            <div
                                class="flex justify-between font-mono text-[10px] font-bold text-brand-textMuted uppercase">
                                <span>Torso Width</span>
                                <span id="valTorsoWidth">1.0x</span>
                            </div>
                            <input type="range" min="0.5" max="2.0" step="0.1" value="1.0" class="w-full"
                                oninput="update3DModel('torsoWidth', this.value)">
                        </div>

                        <div class="space-y-1">
                            <div
                                class="flex justify-between font-mono text-[10px] font-bold text-brand-textMuted uppercase">
                                <span>Arm Length</span>
                                <span id="valArmLength">1.0x</span>
                            </div>
                            <input type="range" min="0.7" max="1.6" step="0.05" value="1.0" class="w-full"
                                oninput="update3DModel('armLength', this.value)">
                        </div>

                        <div class="space-y-1">
                            <div
                                class="flex justify-between font-mono text-[10px] font-bold text-brand-textMuted uppercase">
                                <span>Arm Thickness</span>
                                <span id="valArmThickness">1.0x</span>
                            </div>
                            <input type="range" min="0.5" max="2.0" step="0.1" value="1.0" class="w-full"
                                oninput="update3DModel('armThickness', this.value)">
                        </div>

                        <div class="space-y-1">
                            <div
                                class="flex justify-between font-mono text-[10px] font-bold text-brand-textMuted uppercase">
                                <span>Leg Length</span>
                                <span id="valLegLength">1.0x</span>
                            </div>
                            <input type="range" min="0.7" max="1.6" step="0.05" value="1.0" class="w-full"
                                oninput="update3DModel('legLength', this.value)">
                        </div>

                        <div class="space-y-1">
                            <div
                                class="flex justify-between font-mono text-[10px] font-bold text-brand-textMuted uppercase">
                                <span>Leg Thickness</span>
                                <span id="valLegThickness">1.0x</span>
                            </div>
                            <input type="range" min="0.5" max="2.0" step="0.1" value="1.0" class="w-full"
                                oninput="update3DModel('legThickness', this.value)">
                        </div>

                        <div class="my-3 border-t-2 border-brand-border border-dashed"></div>
                        <div
                            class="text-xs font-mono font-bold text-brand-text uppercase mb-2 pb-2 border-b-2 border-brand-border">
                            /// POSE CONTROLS</div>

                        <div class="space-y-1">
                            <div
                                class="flex justify-between font-mono text-[10px] font-bold text-brand-textMuted uppercase">
                                <span>Left Arm Rotate</span>
                                <span id="valArmLRot">45°</span>
                            </div>
                            <input type="range" min="-180" max="180" step="5" value="45" class="w-full"
                                oninput="updatePose('armLRot', this.value)">
                        </div>

                        <div class="space-y-1">
                            <div
                                class="flex justify-between font-mono text-[10px] font-bold text-brand-textMuted uppercase">
                                <span>Right Arm Rotate</span>
                                <span id="valArmRRot">45°</span>
                            </div>
                            <input type="range" min="-180" max="180" step="5" value="45" class="w-full"
                                oninput="updatePose('armRRot', this.value)">
                        </div>

                        <div class="space-y-1">
                            <div
                                class="flex justify-between font-mono text-[10px] font-bold text-brand-textMuted uppercase">
                                <span>Head Tilt</span>
                                <span id="valHeadRot">0°</span>
                            </div>
                            <input type="range" min="-45" max="45" step="5" value="0" class="w-full"
                                oninput="updatePose('headRot', this.value)">
                        </div>

                        <div class="pt-4 mt-auto border-t-2 border-brand-border border-dashed space-y-2">
                            <button
                                class="w-full py-2 border-2 border-brand-border font-mono text-xs font-bold hover:bg-brand-canvas transition-colors"
                                onclick="resetRig()">
                                RESET ALL
                            </button>
                        </div>
                    </div>
                </div>

                <div id="rigCollapsedMsg" class="h-12 flex items-center justify-center bg-gray-50">
                    <p class="font-mono text-xs text-brand-textMuted">/// RIGGING_MODULE_OFFLINE</p>
                </div>
            </div>

            <div id="resultsContainer"
                class="flex-1 min-h-[300px] bg-white border-3 border-brand-border shadow-hard relative flex flex-col">

                <div class="h-10 border-b-2 border-brand-border flex justify-between items-center px-4 bg-brand-canvas">
                    <span class="font-mono text-[10px] font-bold text-brand-textMuted uppercase">///
                        OUTPUT_BUFFER</span>
                    <div class="flex gap-2">
                        <div class="w-2 h-2 rounded-full bg-red-500 border border-brand-border"></div>
                        <div class="w-2 h-2 rounded-full bg-yellow-500 border border-brand-border"></div>
                        <div class="w-2 h-2 rounded-full bg-green-500 border border-brand-border"></div>
                    </div>
                </div>

                <div class="flex-1 relative bg-brand-text p-1">

                    <div id="emptyState"
                        class="absolute inset-0 flex flex-col items-center justify-center text-center p-6 opacity-40">
                        <div class="w-full h-full absolute inset-0 opacity-10"
                            style="background-image: radial-gradient(#fff 1px, transparent 1px); background-size: 20px 20px;">
                        </div>
                        <div class="relative z-10 border-2 border-brand-textMuted p-6 text-brand-textMuted">
                            <i data-lucide="layout-grid" class="w-12 h-12 mb-4 mx-auto"></i>
                            <h3 class="font-mono font-bold text-lg uppercase">Buffer Empty</h3>
                            <p class="font-mono text-xs mt-2">Configure parameters and<br>execute generation.</p>
                        </div>
                    </div>

                    <div id="loadingState"
                        class="hidden absolute inset-0 bg-brand-text z-20 flex flex-col items-center justify-center text-brand-accent">
                        <div class="font-mono text-4xl font-bold tracking-widest mb-4">COMPILING</div>
                        <div class="flex gap-1 mb-4">
                            <div class="w-2 h-8 bg-brand-accent animate-pulse"></div>
                            <div class="w-2 h-8 bg-brand-accent animate-pulse delay-75"></div>
                            <div class="w-2 h-8 bg-brand-accent animate-pulse delay-150"></div>
                        </div>
                        <div class="font-mono text-xs mt-4 text-white">/// RENDER_PIPELINE_ACTIVE...</div>
                        <div class="absolute inset-0 scanline pointer-events-none opacity-20"></div>
                    </div>

                    <div id="resultsGrid"
                        class="hidden absolute inset-0 overflow-y-auto grid grid-cols-2 lg:grid-cols-4 gap-1 p-1">
                        </div>
                </div>

                <div
                    class="h-8 bg-brand-text text-white flex items-center justify-between px-3 font-mono text-[10px] uppercase border-t-2 border-brand-border z-10">
                    <div class="flex items-center gap-2">
                        <span class="w-2 h-2 rounded-full bg-brand-textMuted" id="statusLight"></span>
                        <span id="statusText">SYSTEM_IDLE</span>
                    </div>
                    <div class="font-mono text-brand-textMuted">V2.1.4</div>
                </div>
            </div>

        </section>

    </main>

    <script>
        // Init Icons
        lucide.createIcons();

        /* --- UI Logic --- */

        // Toggle Custom Dimensions
        function toggleCustomDims() {
            const isCustom = document.querySelector('input[name="dimensions"][value="custom"]').checked;
            const customDimsContainer = document.getElementById('customDimsContainer');
            if (isCustom) {
                customDimsContainer.classList.remove('hidden');
                customDimsContainer.classList.add('grid');
            } else {
                customDimsContainer.classList.add('hidden');
                customDimsContainer.classList.remove('grid');
            }
        }

        // Clear Color Swatches
        function clearColors() {
            document.getElementById('color1').value = '#FFFFFF';
            document.getElementById('color2').value = '#FFFFFF';
            document.getElementById('color3').value = '#FFFFFF';
            document.getElementById('color4').value = '#FFFFFF';
            updateColorSwatches();
        }

        // Update Color Swatch Visuals
        function updateColorSwatches() {
            for (let i = 1; i <= 4; i++) {
                const input = document.getElementById('color' + i);
                const display = input.nextElementSibling;
                display.style.backgroundColor = input.value;
            }
        }

        // Add event listeners for color inputs
        document.addEventListener('DOMContentLoaded', () => {
            for (let i = 1; i <= 4; i++) {
                const colorInput = document.getElementById('color' + i);
                colorInput.addEventListener('input', updateColorSwatches);
            }
        });
        const rigToggle = document.getElementById('rigToggle');
        const rigPanel = document.getElementById('rigPanel');
        const rigCollapsedMsg = document.getElementById('rigCollapsedMsg');
        const generateBtn = document.getElementById('generateBtn');
        const statusText = document.getElementById('statusText');
        const statusLight = document.getElementById('statusLight');
        let credits = 449;
        let isRigInitialized = false;

        function toggleRigPanel() {
            if (rigToggle.checked) {
                rigPanel.classList.remove('hidden');
                rigPanel.classList.add('flex');
                rigCollapsedMsg.classList.add('hidden');
                
                // Add a small delay to ensure DOM is laid out before init
                // This prevents the canvas from being 0x0 size
                requestAnimationFrame(() => {
                    if (!isRigInitialized) {
                        initThreeJS();
                        isRigInitialized = true;
                    } else if (camera && renderer) {
                        onWindowResize(); // Force resize update if re-opening
                    }
                });
                
            } else {
                rigPanel.classList.add('hidden');
                rigPanel.classList.remove('flex');
                rigCollapsedMsg.classList.remove('hidden');
            }
        }

        /* --- Three.js Procedural Rig Logic (CARTOON / MANNEQUIN STYLE) --- */
        let scene, camera, renderer, characterGroup;

        // Store rig components for parametric updates
        const rig = {
            groups: {}, // Pivot joints
            meshes: {}  // Geometry
        };

        let params = {
            height: 1.0,
            head: 1.0,
            torsoLength: 1.0,
            torsoWidth: 1.0,
            armLength: 1.0,
            armThickness: 1.0,
            legLength: 1.0,
            legThickness: 1.0,
        };

        function initThreeJS() {
            const container = document.getElementById('canvasContainer');
            
            // Safety check for container size
            const width = container.clientWidth || 300;
            const height = container.clientHeight || 300;

            scene = new THREE.Scene();
            scene.background = new THREE.Color(0xe5e7eb); // Light Grey bg

            // Isometric-ish Camera
            const aspect = width / height;
            camera = new THREE.PerspectiveCamera(40, aspect, 0.1, 1000);
            camera.position.set(0, 1.5, 6); // Look straight on slightly elevated
            camera.lookAt(0, 0.8, 0);

            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(width, height);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            container.appendChild(renderer.domElement);

            const controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.target.set(0, 0.8, 0); // Focus on torso center
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;

            // Soft Studio Lighting
            const hemiLight = new THREE.HemisphereLight(0xffffff, 0xffffff, 0.6);
            scene.add(hemiLight);

            const dirLight = new THREE.DirectionalLight(0xffffff, 0.7);
            dirLight.position.set(2, 5, 5);
            dirLight.castShadow = true;
            dirLight.shadow.mapSize.width = 1024;
            dirLight.shadow.mapSize.height = 1024;
            dirLight.shadow.radius = 4;
            scene.add(dirLight);

            // Floor Plane (Shadow catcher)
            const planeGeometry = new THREE.PlaneGeometry(10, 10);
            const planeMaterial = new THREE.ShadowMaterial({ opacity: 0.1 });
            const plane = new THREE.Mesh(planeGeometry, planeMaterial);
            plane.rotation.x = -Math.PI / 2;
            plane.position.y = 0;
            plane.receiveShadow = true;
            scene.add(plane);

            createProceduralCharacter();
            
            // Initial Pose setup
            updatePose('armLRot', 45);
            updatePose('armRRot', 45);
            
            animate();
            window.addEventListener('resize', onWindowResize, false);
        }

        function createProceduralCharacter() {
            if (characterGroup) scene.remove(characterGroup);
            characterGroup = new THREE.Group();
            scene.add(characterGroup);

            // Material: Smooth Grey Plastic (Mannequin style)
            const matBody = new THREE.MeshStandardMaterial({ 
                color: 0xcccccc, // Neutral Grey
                roughness: 0.4,
                metalness: 0.1
            });
            
            const matJoint = new THREE.MeshStandardMaterial({ 
                color: 0xaaaaaa, // Darker Grey for joints
                roughness: 0.5 
            });

            // --- HIPS (Root) ---
            rig.groups.hips = new THREE.Group();
            rig.groups.hips.position.y = 1.0; // Starting leg height
            characterGroup.add(rig.groups.hips);

            // Hip Shape (Sphere)
            const hipGeo = new THREE.SphereGeometry(0.26, 32, 32);
            const hipMesh = new THREE.Mesh(hipGeo, matBody);
            hipMesh.scale.set(1.1, 0.8, 0.9); // Slightly flattened sphere
            hipMesh.castShadow = true;
            rig.groups.hips.add(hipMesh);
            rig.meshes.hips = hipMesh;

            // --- LEGS ---
            function createLeg(side) { // 1 = left, -1 = right
                const name = side === 1 ? 'legL' : 'legR';
                
                // Hip Joint Group
                const legGroup = new THREE.Group();
                legGroup.position.set(side * 0.18, 0, 0); // Offset from hip center
                rig.groups.hips.add(legGroup);
                rig.groups[name] = legGroup;

                // Joint Sphere (Hidden pivot visual)
                const jointGeo = new THREE.SphereGeometry(0.14, 24, 24);
                const jointMesh = new THREE.Mesh(jointGeo, matJoint);
                legGroup.add(jointMesh);

                // Leg Cylinder (Smooth)
                const legGeo = new THREE.CylinderGeometry(0.12, 0.1, 1, 32);
                const legMesh = new THREE.Mesh(legGeo, matBody);
                legMesh.position.y = -0.5; // Offset so pivot is at top
                legMesh.castShadow = true;
                legGroup.add(legMesh);
                rig.meshes[name] = legMesh;

                // Foot - FIXED: Replaced Capsule with Box for compatibility
                const footGeo = new THREE.BoxGeometry(0.2, 0.15, 0.3);
                const footMesh = new THREE.Mesh(footGeo, matBody);
                footMesh.position.y = -0.55; 
                footMesh.position.z = 0.08;
                legMesh.add(footMesh);
                rig.meshes[name+'_foot'] = footMesh;
            }
            createLeg(1);
            createLeg(-1);

            // --- TORSO ---
            rig.groups.torso = new THREE.Group();
            rig.groups.hips.add(rig.groups.torso);

            // Torso Shape (Rounded Cylinder / Capsule-ish)
            const torsoGeo = new THREE.CylinderGeometry(0.28, 0.24, 1, 32);
            const torsoMesh = new THREE.Mesh(torsoGeo, matBody);
            torsoMesh.position.y = 0.5; // Pivot at bottom (waist)
            torsoMesh.castShadow = true;
            rig.groups.torso.add(torsoMesh);
            rig.meshes.torso = torsoMesh;

            // --- NECK & HEAD ---
            rig.groups.neck = new THREE.Group();
            rig.groups.neck.position.y = 1.0; // Top of torso
            rig.groups.torso.add(rig.groups.neck);

            // Neck
            const neckGeo = new THREE.CylinderGeometry(0.1, 0.12, 0.15, 24);
            const neckMesh = new THREE.Mesh(neckGeo, matBody);
            neckMesh.position.y = 0.075;
            rig.groups.neck.add(neckMesh);

            // Head Group (for independent scaling)
            rig.groups.head = new THREE.Group();
            rig.groups.head.position.y = 0.15; // Top of neck
            rig.groups.neck.add(rig.groups.head);

            // Head Shape (Smooth Sphere)
            const headGeo = new THREE.SphereGeometry(0.35, 32, 32);
            const headMesh = new THREE.Mesh(headGeo, matBody);
            headMesh.position.y = 0.35; // Center head above pivot
            headMesh.castShadow = true;
            rig.groups.head.add(headMesh);
            rig.meshes.head = headMesh;

            // --- ARMS ---
            function createArm(side) {
                const name = side === 1 ? 'armL' : 'armR';

                // Shoulder Joint Group (Anchor to Torso)
                const shoulderGroup = new THREE.Group();
                // Position will be set dynamically in update
                rig.groups.torso.add(shoulderGroup);
                rig.groups[name] = shoulderGroup;

                // Shoulder Joint Sphere
                const jointGeo = new THREE.SphereGeometry(0.14, 24, 24);
                const jointMesh = new THREE.Mesh(jointGeo, matJoint);
                shoulderGroup.add(jointMesh);

                // Arm Mesh
                const armGeo = new THREE.CylinderGeometry(0.11, 0.09, 1, 32);
                const armMesh = new THREE.Mesh(armGeo, matBody);
                armMesh.position.y = -0.5; // Hang down
                armMesh.castShadow = true;
                shoulderGroup.add(armMesh);
                rig.meshes[name] = armMesh;

                // Hand (Sphere)
                const handGeo = new THREE.SphereGeometry(0.12, 16, 16);
                const handMesh = new THREE.Mesh(handGeo, matBody);
                handMesh.position.y = -0.55;
                armMesh.add(handMesh);
            }
            createArm(1);
            createArm(-1);

            updateAllParams();
        }

        /* --- LOGIC: Parametric Updates (No Breaking) --- */
        function update3DModel(param, value) {
            params[param] = parseFloat(value);
            
            // Label update
            const labelId = 'val' + param.charAt(0).toUpperCase() + param.slice(1);
            const el = document.getElementById(labelId);
            if(el) el.innerText = params[param].toFixed(1) + 'x';

            updateAllParams();
        }

        function updateAllParams() {
            if(!rig.groups.hips) return;

            // Base dimensions
            const BASE_LEG_LEN = 1.0;
            const BASE_TORSO_LEN = 1.0; // The geometry height
            const BASE_ARM_LEN = 1.0;

            const hMult = params.height;

            // 1. LEGS (Scale Length)
            const legLen = BASE_LEG_LEN * params.legLength * hMult;
            ['legL', 'legR'].forEach(name => {
                const m = rig.meshes[name];
                // Scale Y for length, X/Z for thickness
                m.scale.set(params.legThickness, legLen, params.legThickness);
                // Move mesh down so pivot stays at top
                m.position.y = -legLen / 2;
                // Move foot to bottom of new leg length
                const foot = rig.meshes[name+'_foot'];
                if(foot) foot.position.y = -0.5 - (0.05 / legLen); // Approximate adjustment
            });

            // 2. HIPS HEIGHT
            // Move entire hip group up so feet stay on floor (y=0)
            // Leg length + foot radius approx
            rig.groups.hips.position.y = legLen + 0.1; 

            // 3. TORSO (Scale)
            const torsoLen = BASE_TORSO_LEN * params.torsoLength * hMult;
            const tMesh = rig.meshes.torso;
            tMesh.scale.set(params.torsoWidth, torsoLen, params.torsoWidth);
            tMesh.position.y = torsoLen / 2; // Grow upwards from waist

            // 4. NECK POSITION (Follow Torso Top)
            rig.groups.neck.position.y = torsoLen;

            // 5. HEAD (Uniform Scale)
            const hScale = params.head;
            rig.meshes.head.scale.set(hScale, hScale, hScale);
            // Adjust head position slightly based on scale to not clip into neck
            rig.meshes.head.position.y = 0.25 * hScale;

            // 6. SHOULDERS POSITION (Follow Torso Top & Width)
            const shoulderY = torsoLen - 0.1; // Slightly below neck
            const shoulderX = (0.28 * params.torsoWidth) + 0.05; // Radius of torso + offset
            
            rig.groups.armL.position.set(shoulderX, shoulderY, 0);
            rig.groups.armR.position.set(-shoulderX, shoulderY, 0);

            // 7. ARMS (Scale)
            const armLen = BASE_ARM_LEN * params.armLength * hMult;
            ['armL', 'armR'].forEach(name => {
                const m = rig.meshes[name];
                m.scale.set(params.armThickness, armLen, params.armThickness);
                m.position.y = -armLen / 2;
            });
        }

        function updatePose(part, value) {
            value = parseFloat(value);
            const rad = THREE.Math.degToRad(value);

            // Update Label
            const labelEl = document.getElementById('val' + part.charAt(0).toUpperCase() + part.slice(1));
            if(labelEl) labelEl.innerText = value + '°';

            if (part === 'armLRot' && rig.groups.armL) rig.groups.armL.rotation.z = -rad; // Invert for natural feel
            if (part === 'armRRot' && rig.groups.armR) rig.groups.armR.rotation.z = rad;
            if (part === 'headRot' && rig.groups.neck) rig.groups.neck.rotation.z = rad;
        }

        function resetRig() {
            const defaults = {
                height: 1.0, head: 1.0, torsoLength: 1.0, torsoWidth: 1.0,
                armLength: 1.0, armThickness: 1.0, legLength: 1.0, legThickness: 1.0
            };
            
            // Reset Sliders
            document.querySelectorAll('input[type="range"]').forEach(input => {
                if(input.getAttribute('oninput').includes('updatePose')) {
                    // Poses defaults
                    if(input.getAttribute('oninput').includes('arm')) input.value = 45;
                    else input.value = 0;
                } else {
                    // Size defaults
                    input.value = 1.0;
                }
                input.dispatchEvent(new Event('input'));
            });
        }

        function animate() {
            requestAnimationFrame(animate);
            renderer.render(scene, camera);
        }

        function onWindowResize() {
            if (!camera || !renderer) return;
            const container = document.getElementById('canvasContainer');
            // Safety check
            if (!container || container.clientWidth === 0) return;
            
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        }

        // Generate Button Dummy Logic
        function generateSprite() {
            const loadingState = document.getElementById('loadingState');
            const resultsGrid = document.getElementById('resultsGrid');
            const emptyState = document.getElementById('emptyState');

            emptyState.classList.add('hidden');
            resultsGrid.classList.add('hidden');
            loadingState.classList.remove('hidden');
            
            statusText.innerText = "PROCESSING_ASSETS...";
            statusLight.classList.remove('bg-brand-textMuted');
            statusLight.classList.add('bg-brand-accent', 'animate-pulse');

            setTimeout(() => {
                loadingState.classList.add('hidden');
                resultsGrid.classList.remove('hidden');
                statusText.innerText = "GENERATION_COMPLETE";
                statusLight.classList.remove('bg-brand-accent', 'animate-pulse');
                statusLight.classList.add('bg-green-500');
                
                // Render dummy cards
                const seed = Math.floor(Math.random() * 1000);
                resultsGrid.innerHTML = [1, 2, 3, 4].map(i => `
                    <div class="group relative bg-white border-2 border-transparent hover:border-brand-accent transition-colors flex flex-col h-full overflow-hidden">
                        <div class="bg-brand-canvas border-b-2 border-brand-border p-2 flex justify-between items-center">
                            <span class="font-mono text-[10px] font-bold text-brand-textMuted">VAR_0${i}</span>
                        </div>
                        <div class="flex-1 bg-gray-50 flex items-center justify-center p-4">
                            <img src="https://api.dicebear.com/7.x/pixel-art/svg?seed=${seed + i}" class="w-24 h-24 image-pixelated">
                        </div>
                    </div>
                `).join('');

                credits--;
                document.getElementById('creditCount').innerText = credits;
            }, 2000);
        }
    </script>
</body>
</html>